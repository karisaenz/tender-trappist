---
// src/components/ImageCarousel.astro
const { heroSlides } = Astro.props; // Expect array of { src: string, alt: string }
---

<section class="hero-carousel" aria-labelledby="hero-heading" aria-roledescription="carousel">
  <!-- Slides container -->
  <div class="slides-container" id="slides">
    {heroSlides.map((slide, index) => (
      <div
        class="slide {index === 0 ? 'active' : ''}"
        aria-hidden={index !== 0 ? 'true' : 'false'}
        role="group"
        aria-roledescription="slide"
      >
        <picture>
          <source
            srcset={`${slide.src.replace('.webp', '-800.webp')} 800w, ${slide.src} 1600w`}
            sizes="(max-width: 768px) 100vw, 1600px"
            type="image/webp"
          />
          <img
            src={slide.src}
            alt={slide.alt} 
            width="1600"
            height="900"
            loading='lazy'  // Eager for first = better LCP
            decoding="async"
            class="hero-image"
          />
        </picture>
      </div>
    ))}
  </div>

 <!--  Overlay content (fixed on top)
  <div class="hero-content">
    <div class="hero-container">
      <h1 id="hero-heading" class="hero-title">
        Bocanada Pizza
      </h1>
      <p class="hero-subtitle">
        Pizza artesanal napolitana • Sabores ecuatorianos auténticos • 
        <strong>Centro Histórico de Quito</strong> con vista al Panecillo
      </p>
      <div class="hero-ctas">
        <a href="#menu" class="btn btn-primary">Ver Menú</a>
        <a href="tel:+593989538444" class="btn btn-outline">Pedir ahora • 098 953 8444</a>
      </div>
      <div class="hero-trust">
        <span>★ 4.8 en reseñas locales</span>
        <span>• Delivery en Quito</span>
      </div>
    </div>
  </div> -->

  <!-- Controls: Dots + Pause/Play -->
  <div class="carousel-controls">
    <div class="dots" aria-label="Slides navigation">
      {heroSlides.map((_, index) => (
        <button
          class="dot {index === 0 ? 'active' : ''}"
          aria-label={`Ir a slide ${index + 1}`}
          aria-controls="slides"
          data-slide={index}
        ></button>
      ))}
    </div>

    <button class="pause-play" aria-label="Pausar autoplay" data-state="playing">
      ⏸️ <!-- Pause icon; changes to ▶️ on pause -->
    </button>
  </div>
</section>

<style>
  .hero-carousel {
    position: relative;
    height: 85vh;
    min-height: 600px;
    max-height: 900px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
  }

  .slides-container {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .slide {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.8s ease;
    pointer-events: none;
    background: #1a1a1a;           /* Dark fallback color for letterbox areas – looks intentional */
    display: flex;                 /* Centers the image if using contain */
    align-items: center;
    justify-content: center;
  }

  .slide.active {
    opacity: 1;
    pointer-events: auto;
  }

  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    max-width: 100%;               /* Safety nets */
    max-height: 100%;
  }

  .hero-content {
    position: relative;
    z-index: 3;
    padding: 2rem;
    max-width: 1100px;
    width: 100%;
  }

  /* Overlay gradient for text readability */
  .hero-carousel::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.7) 100%);
    z-index: 1;
    pointer-events: none;
  }

  /* Dots & controls */
  .carousel-controls {
    position: absolute;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 4;
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .dots {
    display: flex;
    gap: 0.8rem;
  }

  .dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    border: 2px solid white;
    cursor: pointer;
    transition: all 0.3s;
  }

  .dot.active,
  .dot:hover {
    background: white;
    transform: scale(1.2);
  }

  .pause-play {
    background: rgba(0,0,0,0.5);
    color: white;
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    font-size: 1.4rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s;
  }

  .pause-play:hover {
    background: rgba(0,0,0,0.7);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .hero-carousel { min-height: 70vh; }
    .carousel-controls { bottom: 1.2rem; }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.slides-container');
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.dot');
    const pauseBtn = document.querySelector('.pause-play');
    let current = 0;
    let interval;
    let isPaused = false;

    const showSlide = (index) => {
      slides.forEach((s, i) => {
        s.classList.toggle('active', i === index);
        s.setAttribute('aria-hidden', i !== index);
      });
      dots.forEach((d, i) => d.classList.toggle('active', i === index));
      current = index;
    };

    const nextSlide = () => {
      let next = (current + 1) % slides.length;
      showSlide(next);
    };

    const startAuto = () => {
      if (!isPaused) {
        interval = setInterval(nextSlide, 5000); // Change every 5 seconds
      }
    };

    const stopAuto = () => clearInterval(interval);

    // Dot clicks
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        showSlide(index);
        stopAuto();
        startAuto(); // Restart timer
      });
    });

    // Pause / Play
    pauseBtn.addEventListener('click', () => {
      isPaused = !isPaused;
      if (isPaused) {
        stopAuto();
        pauseBtn.textContent = '▶️';
        pauseBtn.setAttribute('aria-label', 'Reproducir autoplay');
      } else {
        startAuto();
        pauseBtn.textContent = '⏸️';
        pauseBtn.setAttribute('aria-label', 'Pausar autoplay');
      }
    });

    // Start on load
    startAuto();

    // Optional: Pause on hover/focus (accessibility)
    document.querySelector('.hero-carousel').addEventListener('mouseenter', stopAuto);
    document.querySelector('.hero-carousel').addEventListener('mouseleave', () => {
      if (!isPaused) startAuto();
    });
  });
</script>